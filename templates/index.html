{% extends 'base.html' %}


{% set title_1 = sample_sudokus[0]["title"] %} 
{% set board_1 = sample_sudokus[0]["board"] %} 

{% set title_2 = sample_sudokus[1]["title"] %}
{% set board_2 = sample_sudokus[1]["board"] %} 

{% block body %}
  
    <h1>Automatic Sudoku Solver</h1>

    <!-- I could make code shorter and scalable by looping through sample sodukus -->
    <label for="game1">{{title_1}}: </label>
    <p id="game1" style="background-color:white; border:1px solid black; width:fit-content;display:inline">
        {{board_1}}</p>
    <input type="button" value="Choose" onclick ="input_handler(1)"/><br>

    <label for="game2">{{title_2}}:</label>
    <p id="game2" style="background-color:white; border:1px solid black; width:fit-content;display:inline">
        {{board_2}}</p>
    <input type="button" value="Choose" onclick ="input_handler(2)"/>
    
    <form method="post" action="{{ url_for('solver') }}"  id="sudoku_form_1">
        <input type="hidden" name="board" id="game1_input" value={{board_1}}>
        <input type="hidden" name="sudoko_number" value="1">
    </form>

    <form method="post" action="{{ url_for('solver') }}" id="sudoku_form_2">                       
        <input type="hidden" name="board" id="game2_input" value={{board_2}}>
        <input type="hidden" name="sudoko_number" value="2">
    </form>
 
    <form method="post" action="{{ url_for('solver') }}" autocomplete="off" id="sudoku_form_3">
        <label for="game3_input">Enter Your Soduko:</label>
        <input type="text" style="display: inline;margin-top: 1em;margin-bottom: 1em;margin-left: 0; margin-right: 0;"
               name="board" id="game3_input" size="86" maxlength="81" 
               placeholder="Enter initial board position as 81 digit string"
               {% if sudoku_number == 3 %}
                   value={{sudoku_string}}
               {% endif %}>
        <input type="hidden" name="sudoko_number" value="3">
        <input type="button" value="Choose" onclick ="input_handler(3)"/>
    </form>

    <p id="input_feedback"></p>
  
    <p id="sudoku_title">Sudoku</p>

    <div class="board">
        <div class="subboard">
            <div id="0">0</div>
            <div id="1">1</div>
            <div id="2">2</div>
            <div id="9">9</div>
            <div id="10">10</div>
            <div id="11">11</div>
            <div id="18">18</div>
            <div id="19">19</div>
            <div id="20">20</div>
        </div>
        <div class="subboard">
            <div id="3">3</div>
            <div id="4">4</div>
            <div id="5">5</div>
            <div id="12">12</div>
            <div id="13">13</div>
            <div id="14">14</div>
            <div id="21">21</div>
            <div id="22">22</div>
            <div id="23">23</div>
        </div>
        
        <div class="subboard">
            <div id="6">6</div>
            <div id="7">7</div>
            <div id="8">8</div>
            <div id="15">15</div>
            <div id="16">16</div>
            <div id="17">17</div>
            <div id="24">24</div>
            <div id="25">24</div>
            <div id="26">26</div>
        </div>
        <div class="subboard">
            <div id="27">27</div>
            <div id="28">28</div>
            <div id="29">29</div>
            <div id="36">36</div>
            <div id="37">37</div>
            <div id="38">38</div>
            <div id="45">45</div>
            <div id="46">46</div>
            <div id="47">47</div>
        </div>
        <div class="subboard">
            <div id="30">30</div>
            <div id="31">31</div>
            <div id="32">32</div>
            <div id="39">39</div>
            <div id="40">40</div>
            <div id="41">41</div>
            <div id="48">48</div>
            <div id="49">49</div>
            <div id="50">50</div>
        </div>
        <div class="subboard">
            <div id="33">33</div>
            <div id="34">34</div>
            <div id="35">35</div>
            <div id="42">42</div>
            <div id="43">43</div>
            <div id="44">44</div>
            <div id="51">51</div>
            <div id="52">52</div>
            <div id="53">53</div>
        </div>
        <div class="subboard">
            <div id="54">54</div>
            <div id="55">55</div>
            <div id="56">56</div>
            <div id="63">63</div>
            <div id="64">64</div>
            <div id="65">65</div>
            <div id="72">72</div>
            <div id="73">73</div>
            <div id="74">74</div>
        </div>
        <div class="subboard">
            <div id="57">57</div>
            <div id="58">58</div>
            <div id="59">59</div>
            <div id="66">66</div>
            <div id="67">67</div>
            <div id="68">68</div>
            <div id="75">75</div>
            <div id="76">76</div>
            <div id="77">77</div>
        </div>
        <div class="subboard">
            <div id="60">60</div>
            <div id="61">61</div>
            <div id="62">62</div>
            <div id="69">69</div>
            <div id="70">70</div>
            <div id="71">71</div>
            <div id="78">78</div>
            <div id="79">79</div>
            <div id="80">80</div>
        </div>
    </div>

    <input id="solve_btn" style="margin:25px" type="button" value="Solve"/>

    <script>
        document.getElementById("game3_input").focus();

        document.getElementById("game3_input").addEventListener('input', (event) => {
            input_handler(3)    ;
        });


        function show_board(game_number, sudoku, is_solution=false){
            /* game_number is an integer
               sudoku is 81 string (possibly with errors)
               optional argument tells us if it is a solution or not 
            
               This function should do the following: 
               1)
               If not solution 
                  Draw the soduku, and make non-zero input fontweight bold.
               If solution:
                  Draw the solution without changing bold fontweight 
               
               2)
               Show title of sudoku
               
            //Draw sudoku */

            for (let index = 0; index < 81; index++) {
                if (sudoku[index] != "0"){
                    document.getElementById(index).innerHTML = sudoku[index]
                    if(!is_solution){
                        document.getElementById(index).style.fontWeight = "bold";
                    }
                }
                else{
                    //input is 0: this only happens when input is not a solution
                    document.getElementById(index).style.fontWeight = "normal";
                    document.getElementById(index).innerHTML = "&nbsp";
                }
            }
            // Show title
            const titles = {
                1: '{{sample_sudokus[0]["title"]}}',
                2: '{{sample_sudokus[1]["title"]}}',
                3: '{{sample_sudokus[2]["title"]}}',
            }
            document.getElementById("sudoku_title").innerHTML=titles[game_number];
        }

        
        function zero_pad(str){
                //right pad string with zeros if it's shorter than 81 digits
                zeros = "".padStart(81 - str.length, '0');
                str += zeros;
                return str             
            }


        
        function input_handler(game_number){
            /*This function is to be called, when user enters "choose" and every time the value og the
              sudoku input field is changed.
              1) Tell user about possible errors in input (not digit values)
              2) Enable solve button if no errors
                 Disable solve button if errors
              3) Draw input sudoku regardless of errors --> use another function to do this

            */

            original_sudoku = document.getElementById("game"+ game_number + "_input").value;

            /* Check for errors in input */
            isnum = /^\d+$/.test(original_sudoku); //only digits are alloed 
 
            if(!isnum && original_sudoku.length>0){
                //There is an error in input
                document.getElementById("input_feedback").innerHTML = "Invalid input (only digits 0-9 allowed)"
                document.getElementById("input_feedback").style.color="red";      
                document.getElementById("solve_btn").disabled = true;  
            }
            else{
                //No errors in input
                document.getElementById("input_feedback").style.color="black";   
                document.getElementById("input_feedback").innerHTML="";   
                document.getElementById("solve_btn").disabled = false;  
                document.getElementById("solve_btn").addEventListener('click', (event) => {
                    document.getElementById("game"+game_number+"_input").value=zero_pad(original_sudoku)
                    document.getElementById("sudoku_form_" + game_number).submit();
                });
            }

            //Draw board position (regardless of errors in input)
            show_board(game_number, zero_pad(original_sudoku))
        } 
        
    </script>

    {% if return_from_solver%}
        <script>
            show_board("{{sudoku_number}}", "{{sudoku_string}}");
        </script>
        {% if is_solvable == true %}
            <script>
                show_board("{{sudoku_number}}", "{{solved_sudoku}}", is_solution= true);
                document.getElementById("sudoku_title").innerHTML += '  ...' + '<span style="color:green; font-weight:bold"> has been solved!</span>';
            </script>
        {% else %}
            <script>
                document.getElementById("sudoku_title").innerHTML += '  ...' + '<span style="color:red; font-weight:bold"> has no solution!</span>';
            </script>
        {% endif %}
    {% else %}
        <script>
          input_handler(1);
        </script>
    {% endif %} 


{% endblock body %}


