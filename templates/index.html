{% extends 'base.html' %}
{% block body %}


    <h1>Automatic Sudoku Solver</h1>

    <!-- it would be more elegant to define list of predefined sudokus in python and then echo them out -->
    <label for="game1">Sample Sudoku #1: </label>
    <p id="game1" style="background-color:white; border:1px solid black; width:fit-content;display:inline">
        000000000302540000050301070000000004409006005023054790000000050700810000080060009</p>
    <input type="button" value="Choose" onclick ="show_board(1, 'Sample Sudoku #1')"/><br>

    <label for="game2">Sample Sudoku #2: </label>
    <p id="game2" style="background-color:white; border:1px solid black; width:fit-content;display:inline">
        000260701680070090190004500820100040004602900050003028009300074040050036703018000</p>
    <input type="button" value="Choose" onclick ="show_board(2, 'Sample Sudoku #2')"/>

    
    <form method="post" action="{{ url_for('solver') }}"  id="sudoku_form_1">
        <input type="hidden" name="board" id="game1_input" 
               value="000000000302540000050301070000000004409006005023054790000000050700810000080060009">
        <input type="hidden" name="sudoku_title" value="Example Sudoku #1">
        <input type="hidden" name="sudoko_number" value="1">
        
    </form>

    <form method="post" action="{{ url_for('solver') }}" id="sudoku_form_2">                       
        <input type="hidden" name="board" id="game2_input"
               value="000260701680070090190004500820100040004602900050003028009300074040050036703018000">
        <input type="hidden" name="sudoku_title" value="Example Sudoku #2">
        <input type="hidden" name="sudoko_number" value="2">

    </form>
 
    <form method="post" action="{{ url_for('solver') }}" autocomplete="off" id="sudoku_form_3">
        <label for="game3_input">Enter Your Soduko:</label>
        <input type="text" 
               style="
                display: inline;
                margin-top: 1em;
                margin-bottom: 1em;
                margin-left: 0;
                margin-right: 0;"
               name="board"
               id="game3_input"
               size="86" 
               maxlength="81" 
               placeholder="Enter initial board position as 81 digit string"
               {% if sudoku_number == 3 %}
                   value={{sudoku_string}}
                   {% endif %}>

        <input type="hidden" name="sudoku_title" value="Your Sudoku">
        <input type="hidden" name="sudoko_number" value="3">

        <input type="button" value="Choose" onclick ="show_board(3, 'Your Sudoku')"/>

    </form>

    <p id="input_feedback"></p>
  

    <p id="sudoku_title">Sudoku</p>

    <div class="board">
        <div class="subboard">
            <div id="0">0</div>
            <div id="1">1</div>
            <div id="2">2</div>
            <div id="9">9</div>
            <div id="10">10</div>
            <div id="11">11</div>
            <div id="18">18</div>
            <div id="19">19</div>
            <div id="20">20</div>
        </div>
        <div class="subboard">
            <div id="3">3</div>
            <div id="4">4</div>
            <div id="5">5</div>
            <div id="12">12</div>
            <div id="13">13</div>
            <div id="14">14</div>
            <div id="21">21</div>
            <div id="22">22</div>
            <div id="23">23</div>
        </div>
        
        <div class="subboard">
            <div id="6">6</div>
            <div id="7">7</div>
            <div id="8">8</div>
            <div id="15">15</div>
            <div id="16">16</div>
            <div id="17">17</div>
            <div id="24">24</div>
            <div id="25">24</div>
            <div id="26">26</div>
        </div>
        <div class="subboard">
            <div id="27">27</div>
            <div id="28">28</div>
            <div id="29">29</div>
            <div id="36">36</div>
            <div id="37">37</div>
            <div id="38">38</div>
            <div id="45">45</div>
            <div id="46">46</div>
            <div id="47">47</div>
        </div>
        <div class="subboard">
            <div id="30">30</div>
            <div id="31">31</div>
            <div id="32">32</div>
            <div id="39">39</div>
            <div id="40">40</div>
            <div id="41">41</div>
            <div id="48">48</div>
            <div id="49">49</div>
            <div id="50">50</div>
        </div>
        <div class="subboard">
            <div id="33">33</div>
            <div id="34">34</div>
            <div id="35">35</div>
            <div id="42">42</div>
            <div id="43">43</div>
            <div id="44">44</div>
            <div id="51">51</div>
            <div id="52">52</div>
            <div id="53">53</div>
        </div>
        <div class="subboard">
            <div id="54">54</div>
            <div id="55">55</div>
            <div id="56">56</div>
            <div id="63">63</div>
            <div id="64">64</div>
            <div id="65">65</div>
            <div id="72">72</div>
            <div id="73">73</div>
            <div id="74">74</div>
        </div>
        <div class="subboard">
            <div id="57">57</div>
            <div id="58">58</div>
            <div id="59">59</div>
            <div id="66">66</div>
            <div id="67">67</div>
            <div id="68">68</div>
            <div id="75">75</div>
            <div id="76">76</div>
            <div id="77">77</div>
        </div>
        <div class="subboard">
            <div id="60">60</div>
            <div id="61">61</div>
            <div id="62">62</div>
            <div id="69">69</div>
            <div id="70">70</div>
            <div id="71">71</div>
            <div id="78">78</div>
            <div id="79">79</div>
            <div id="80">80</div>
        </div>
    </div>

    <input id="solve_btn" style="margin:25px" type="button" value="Solve"/>

    <script>
        document.getElementById("game3_input").focus();
 
        function show_board(game_number, sudoku_title, is_solved = false){

            /* Show sudoku board -- regardless of errors */
            document.getElementById("sudoku_title").innerHTML = sudoku_title;
            sudoku = document.getElementById("game"+ game_number + "_input").value;

            if(sudoku.length < 81){
                //right pad sudoku with zeros if it's shorter than 81 digits
                zeros = "".padStart(81 - sudoku.length, '0');
                sudoku += zeros;
            }
            for (let index = 0; index < 81; index++) {
                if (sudoku[index]!="0"){
                    document.getElementById(index).style.fontWeight = "bold";
                    document.getElementById(index).innerHTML = sudoku[index]
                }
                else{
                    document.getElementById(index).style.fontWeight = "normal";
                    document.getElementById(index).innerHTML = "&nbsp";
                }
            }

            /* Check for errors in user input */

            isnum = /^\d+$/.test(sudoku); //only digits are alloed 
 
            if(!isnum && sudoku.length>0){
                document.getElementById("input_feedback").innerHTML = "Invalid input (only digits 0-9 allowed)"
                document.getElementById("input_feedback").style.color="red";      
                document.getElementById("solve_btn").disabled = true;
            }
            else{
                //document.getElementById("input_feedback").innerHTML = "You've entered " + sudoku.length + "/81 digits"
                document.getElementById("input_feedback").style.color="black";   
                document.getElementById("input_feedback").innerHTML="";   
                document.getElementById("solve_btn").disabled = false;  
                document.getElementById("solve_btn").addEventListener('click', (event) => {
                    document.getElementById("sudoku_form_" + game_number).submit();
                })
            }
        }
        
        document.getElementById("game3_input").addEventListener('input', (input) =>{
            show_board("3", 'Your Sudoku');
        })
    </script>

    {% if is_solvable %}
        <script>
            show_board("{{sudoku_number}}", "{{sudoku_title}}");
            document.getElementById("input_feedback").innerHTML="";
            document.getElementById("input_feedback").style.color="black";          
        </script>
          <p>Solved sudoku: {{solved_sudoku}}</p>
          <p>Original sudoku: {{sudoku_string}}</p>
    {% elif not_solvable %}
        <script>
            show_board("{{sudoku_number}}", "{{sudoku_title}}");
            document.getElementById("input_feedback").innerHTML="This sudoku has no solution";
            document.getElementById("input_feedback").style.color="red";      
        </script>
    {% else %}
        <script>
          show_board(1, 'Sample Sudoku #1');
        </script>
    {% endif %} 


{% endblock body %}


